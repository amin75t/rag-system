# Chunk 23

اختیاری | سوال کاربر   (user_query: str)
تاریخچه سوالات کاربر (history: list) | آیا ورودی غیرمجاز است؟ (is_illegal: bool)
علت غیرمجاز بودن ورودی  (reason: str) | 1 |
| 6 | prepare_for_generation** | SPAN | اجباری | سوال کاربر  (user_query: str)
تاریخچه سوالات کاربر (history: list)
کانتکست نهایی (context: list)
موارد بعدی در صورت وجود آورده شوند:
قالب پرامپت (prompt_template: str)
پرامپت سیستم (system_prompt: str) | دلخواه | 1 |
| 7 | generation | GENERATION | اجباری | پرامپت ورودی مدل (prompt: str)
پارامترهای ورودی مدل (model_params: dict) | پاسخ مدل | 1 |
| 8 | output_guard | SPAN | اختیاری | سوال کاربر  (user_query: str)
پاسخ مدل یا chunk پاسخ مدل (response: str) | -  آیا خروجی غیرمجاز است؟ (is_illegal: bool)
- علت غیرمجاز بودن خروجی (reason: str) | 1 |

---

