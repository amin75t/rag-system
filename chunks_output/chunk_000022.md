# Chunk 22

ی هستید و باید به سوالات کاربر با دقت و جزئیات پاسخ دهید."
)

prepare_for_generation(
    user_query=user_query, history=history, context=context, system_prompt=system_prompt
) |
|---|


**Table 15**

| شماره | نام | نوع | اختیاری/اجباری | ورودی‌های اجباری | خروجی‌های اجباری | parent |
|---|---|---|---|---|---|---|
| 1 | process_user_query | SPAN | اجباری | سوال کاربر (user_query: str) | پاسخ نهایی کاربر (response: str) | ندارد |
| 2 | fetch_context_via_primary_search | SPAN | اجباری | - | کانتکست (context: list) | 1 |
| 3 | fetch_context_via_secondary_search* | SPAN | اختیاری | - | کانتکست (context: list) | 1 |
| 4 | rerank_context | SPAN | اختیاری | سوال کاربر  (user_query: str)
کانتکست         (context: list) | کانتکست rerank شده (reranked_context: list) | 1 |
| 5 | input_guard | SPAN | اختیاری | سوال کاربر   (user_query: str)
تاریخچه سوالات کاربر (history: list) | آیا ورودی غیرمجاز است؟ (is_illegal: bool)
علت غیرمجاز بودن ورودی  (reason: str) | 1 |
| 6 | prepare_for_generation** |

---

